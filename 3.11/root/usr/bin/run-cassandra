#!/bin/bash

set -o pipefail

source ${CONTAINER_SCRIPTS_PATH}/common.sh

save_env_config_vars

# If the container is using a not empty provided volume, don't try to set
# a new CASSANDRA_ADMIN_PASSWORD
if test "$(ls -A "$HOME/cassandra")"; then
    echo "Using a populated data directory, CASSANDRA_ADMIN_PASSWORD already set"
else
    if [ "$CASSANDRA_ADMIN_PASSWORD" ]; then
        create_admin_user
        turn_authorization_on
        # so far this is not working because cassandra-env.sh file is not modifiable (sits in scripts directory)
        #  turn_on_jmx_authentication
        # makes the admin password mandatory
    else
        usage "CASSANDRA_ADMIN_PASSWORD has to be set"
    fi
fi

exec cassandra -f -R
